# ipc-calc-tools.github.io
# HHSAF データ可視化ツール

WHOが推奨する手指衛生評価フレームワーク「HHSAF (Hand Hygiene Self-Assessment Framework)」のデータを可視化するWebアプリケーションです。
Streamlit (stlite) を使用し、すべての処理をブラウザ上で実行するため、セキュリティ面でも安心です。

## 機能

- **CSVデータのアップロード**: J-SIPHEのrawデータである縦持ち形式のCSVファイルを読み込み
- **ファイルサイズチェック**: アップロード前に合計500MBを超えるファイルを検出し、エラー表示
- **自動エンコーディング判定**: UTF-8、Shift_JIS、CP932に対応
- **5つのコア領域の可視化**: レーダーチャートで各領域のスコアを表示
- **総合スコア表示**: ドーナツチャートで総合スコア（500点満点）を表示
- **判定レベル表示**: スコアに応じた判定レベル（不十分/基本/中級/上級）を表示
- **エリア別達成率グラフ**: 各エリアの達成率（100点満点中）を横棒グラフで表示
- **詳細質問スコアテーブル**: 各エリアごとに展開可能なテーブルで、個別の質問項目とスコアを表示
- **リーダーシップ基準**: 総合スコア376点以上の場合のみ表示
- **経時的変化グラフ**: 複数月のデータがある場合、時系列でスコアの推移を表示
- **施設間比較**: 複数の医療機関のデータを比較表示
- **分析単位の選択**: 月次（Monthly）または年次（Yearly）での集計を選択可能
- **集計方法の選択**: 年次集計時に、年の最後/初め/平均から選択可能
- **インタラクティブなグラフ**: 拡大・縮小、画像保存が可能（Plotly使用）
- **多言語対応**: 日本語と英語の切り替えが可能
- **テーマ切り替え**: グラフの配色をライト/ダークモードから選択可能

## 使用方法

1. `index.html`をブラウザで開く
2. サイドバーの「Data Input」セクションでCSVファイルを選択（ドラッグ＆ドロップ可）
3. 分析結果が自動的に表示されます
4. 複数の施設や年月がある場合は、ドロップダウンで選択できます
5. 言語やグラフの配色は、サイドバーの「⚙️ 設定 / Settings」から変更できます
6. 別のデータを読み込む場合は、サイドバーの「🏠 TOP画面に戻る」ボタンを使用してください

## CSVデータ形式

CSVファイルは以下の列を含む必要があります（順序は問いません）：

- **処方箋発行医療機関コード** (または `ID`, `Code`)
- **施設名** (または `Facility`)
- **登録年月** (または `Date`, `Month`) - 例: 202501, 2025/01
- **質問** (または `Question`) - 例: 1.1 ABHR:POC, 2.1a 研修頻度...
- **スコア** (または `Score`) - 数値

### データ分類ルール

- **Area 1 (システム変革)**: 質問が「1」「追加」「Add」「施設」で始まる
- **Area 2 (教育・研修)**: 質問が「2」で始まる
- **Area 3 (評価とフィードバック)**: 質問が「3」で始まる
- **Area 4 (職場でのリマインダー)**: 質問が「4」で始まる
- **Area 5 (組織の安全風土)**: 質問が「5」で始まる
- **Leadership (リーダーシップ基準)**: 質問が「リ」「Lea」で始まる、または「リーダーシップ」を含む

### 判定レベル

- **0-125点**: 不十分 (Inadequate)
- **126-250点**: 基本 (Basic)
- **251-375点**: 中級 (Intermediate)
- **376-500点**: 上級 (Advanced) - リーダーシップ基準が評価対象になります

### エリア別スコア

各エリアは100点満点で評価されます：
- **Area 1 (システム変革)**: 100点満点
- **Area 2 (教育・研修)**: 100点満点
- **Area 3 (評価とフィードバック)**: 100点満点
- **Area 4 (職場でのリマインダー)**: 100点満点
- **Area 5 (組織の安全風土)**: 100点満点
- **総合スコア**: 5つのエリアの合計（500点満点）

### 分析単位と集計方法

- **月次 (Monthly)**: 各月のデータを個別に分析
- **年次 (Yearly)**: 1年間のデータを集計して分析
  - **年の最後 (End of Year)**: 年の最後の月のデータを使用（デフォルト）
  - **年の初め (Start of Year)**: 年の最初の月のデータを使用
  - **年の平均 (Average)**: 年間の平均値を計算

## 技術スタック

- **Streamlit (stlite)**: PythonのWebアプリフレームワークをWASM化しブラウザで実行
- **Pandas**: データ処理
- **Plotly**: インタラクティブなグラフ描画

## サンプルデータ

`sample_data.csv`にサンプルデータが含まれています。テスト用にご利用ください。

## 注意事項

- ブラウザは最新版のChrome、Firefox、Edge、Safariを推奨
- 初回読み込み時にライブラリをダウンロードするため、時間がかかる場合があります
- **ファイルサイズ制限**: アップロードするファイルの合計サイズは500MBまでです。これを超える場合は、ファイルを分割するか、サイズを削減してから再度お試しください
- 数百MB以上の大きなCSVファイルを読み込む際は、ブラウザのメモリを大量に消費するためご注意ください

## ライセンス

このツールは医療データ解析のためのオープンソースツールです。
